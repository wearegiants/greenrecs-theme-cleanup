!function($,t,e){"use strict";function n(){b=t.$body}function a(t){M.iterate.call(B,h)}function o(){B=$(k.base)}function i(t){var e="";e+='<div class="'+H.bar+'">',e+='<div class="'+H.track+'">',e+='<span class="'+H.handle+'"></span>',e+="</div></div>",t.paddingRight=parseInt(this.css("padding-right"),10),t.paddingBottom=parseInt(this.css("padding-bottom"),10),this.addClass([H.base,t.customClass,t.horizontal?H.horizontal:""].join(" ")).wrapInner('<div class="'+H.content+'" />').prepend(e),t.$content=this.find(k.content),t.$bar=this.find(k.bar),t.$track=this.find(k.track),t.$handle=this.find(k.handle),t.trackMargin=parseInt(t.trackMargin,10),t.$content.on(W.scroll,t,s),this.on(W.touchMouseDown,k.track,t,d).on(W.touchMouseDown,k.handle,t,u),h(t),o()}function l(t){t.$bar.remove(),t.$content.off(W.namespace).contents().unwrap(),this.removeClass([H.base,H.active,t.customClass].join(" ")).off(W.namespace)}function r(t,e,n){var a=n||t.duration,o={};if("number"!==$.type(e)){var i=$(e);if(i.length>0){var l=i.position();e=t.horizontal?l.left+t.$content.scrollLeft():l.top+t.$content.scrollTop()}else e=t.$content.scrollTop()}o[t.horizontal?"scrollLeft":"scrollTop"]=e,t.$content.stop().animate(o,a)}function h(t){t.$el.addClass(H.isSetup);var e={},n={},a={},o=0,i=!0;if(t.horizontal){t.barHeight=t.$content[0].offsetHeight-t.$content[0].clientHeight,t.frameWidth=t.$content.outerWidth(),t.trackWidth=t.frameWidth-2*t.trackMargin,t.scrollWidth=t.$content[0].scrollWidth,t.ratio=t.trackWidth/t.scrollWidth,t.trackRatio=t.trackWidth/t.scrollWidth,t.handleWidth=t.handleSize>0?t.handleSize:t.trackWidth*t.trackRatio,t.scrollRatio=(t.scrollWidth-t.frameWidth)/(t.trackWidth-t.handleWidth),t.handleBounds={left:0,right:t.trackWidth-t.handleWidth},t.$content.css({paddingBottom:t.barHeight+t.paddingBottom});var l=t.$content.scrollLeft();o=l*t.ratio,i=t.scrollWidth<=t.frameWidth,e={width:t.frameWidth},n={width:t.trackWidth,marginLeft:t.trackMargin,marginRight:t.trackMargin},a={width:t.handleWidth}}else{t.barWidth=t.$content[0].offsetWidth-t.$content[0].clientWidth,t.frameHeight=t.$content.outerHeight(),t.trackHeight=t.frameHeight-2*t.trackMargin,t.scrollHeight=t.$content[0].scrollHeight,t.ratio=t.trackHeight/t.scrollHeight,t.trackRatio=t.trackHeight/t.scrollHeight,t.handleHeight=t.handleSize>0?t.handleSize:t.trackHeight*t.trackRatio,t.scrollRatio=(t.scrollHeight-t.frameHeight)/(t.trackHeight-t.handleHeight),t.handleBounds={top:0,bottom:t.trackHeight-t.handleHeight};var r=t.$content.scrollTop();o=r*t.ratio,i=t.scrollHeight<=t.frameHeight,e={height:t.frameHeight},n={height:t.trackHeight,marginBottom:t.trackMargin,marginTop:t.trackMargin},a={height:t.handleHeight}}i?t.$el.removeClass(H.active):t.$el.addClass(H.active),t.$bar.css(e),t.$track.css(n),t.$handle.css(a),m(t,o),t.$el.removeClass(H.setup)}function s(t){M.killEvent(t);var e=t.data,n={};if(e.horizontal){var a=e.$content.scrollLeft();0>a&&(a=0),e.handleLeft=a/e.scrollRatio,e.handleLeft>e.handleBounds.right&&(e.handleLeft=e.handleBounds.right),n={left:e.handleLeft}}else{var o=e.$content.scrollTop();0>o&&(o=0),e.handleTop=o/e.scrollRatio,e.handleTop>e.handleBounds.bottom&&(e.handleTop=e.handleBounds.bottom),n={top:e.handleTop}}e.$handle.css(n)}function c(t){var e=t.originalEvent,n="undefined"!==$.type(e.targetTouches)?e.targetTouches[0]:null;return{pageX:n?n.pageX:t.clientX,pageY:n?n.pageY:t.clientY}}function d(t){M.killEvent(t);var e=t.data,n=c(t),a=e.$track.offset();e.horizontal?(e.pointerStart=n.pageX,e.handleLeft=n.pageX-a.left+z.scrollLeft()-e.handleWidth/2,m(e,e.handleLeft)):(e.pointerStart=n.pageY,e.handleTop=n.pageY-a.top+z.scrollTop()-e.handleHeight/2,m(e,e.handleTop)),g(e)}function u(t){M.killEvent(t);var e=t.data,n=c(t);e.horizontal?(e.pointerStart=n.pageX,e.handleLeft=parseInt(e.$handle.css("left"),10)):(e.pointerStart=n.pageY,e.handleTop=parseInt(e.$handle.css("top"),10)),g(e)}function g(t){t.$content.off(W.namespace),b.on(W.touchMouseMove,t,f).on(W.touchMouseUp,t,p)}function f(t){M.killEvent(t);var e=t.data,n=c(t),a=0;a=e.horizontal?e.handleLeft-(e.pointerStart-n.pageX):e.handleTop-(e.pointerStart-n.pageY),m(e,a)}function p(t){M.killEvent(t),t.data.$content.on(W.scroll,t.data,s),b.off(W.namespace)}function m(t,e){var n={};t.horizontal?(e<t.handleBounds.left&&(e=t.handleBounds.left),e>t.handleBounds.right&&(e=t.handleBounds.right),n={left:e},t.$content.scrollLeft(Math.round(e*t.scrollRatio))):(e<t.handleBounds.top&&(e=t.handleBounds.top),e>t.handleBounds.bottom&&(e=t.handleBounds.bottom),n={top:e},t.$content.scrollTop(Math.round(e*t.scrollRatio))),t.$handle.css(n)}var v=t.Plugin("scrollbar",{widget:!0,defaults:{customClass:"",duration:0,handleSize:0,horizontal:!1,trackMargin:0},classes:["content","bar","track","handle","horizontal","setup","active"],methods:{_setup:n,_construct:i,_destruct:l,_resize:a,scroll:r,resize:h}}),k=v.classes,H=k.raw,W=v.events,M=v.functions,b,z=t.$window,B=[];W.touchMouseDown=[W.touchStart,W.mouseDown].join(" "),W.touchMouseMove=[W.touchMove,W.mouseMove].join(" "),W.touchMouseUp=[W.touchEnd,W.mouseUp].join(" ")}(jQuery,Formstone);