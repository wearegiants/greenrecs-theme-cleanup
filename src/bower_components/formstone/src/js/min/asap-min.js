!function($,e,t){"use strict";function r(t){x||e.support.history&&(m=e.$body,x=$.extend(w,t),x.$container=$(x.container),x.render===$.noop&&(x.render=u),x.transitionOut===$.noop&&(x.transitionOut=function(){return $.Deferred().resolve()}),k=window.location.href,v.on(b.popState,l),n())}function a(){m&&m.hasClass(q.base)&&m.off(b.click).removeClass(q.base)}function n(){m&&!m.hasClass(q.base)&&m.on(b.click,w.selector,i).addClass(q.base)}function o(t){x&&e.support.history?t&&s(t):window.location.href=t}function i(e){var t=e.currentTarget;e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||window.location.protocol!==t.protocol||window.location.host!==t.host||"_blank"===t.target||(!t.hash||t.href.replace(t.hash,"")!==window.location.href.replace(location.hash,"")&&t.href!==window.location.href+"#")&&(O.killEvent(e),e.stopImmediatePropagation(),t.href===k||s(t.href))}function l(e){var t=e.originalEvent.state;t&&(x.modal&&0===L&&t.url&&!t.initial?window.location.href=t.url:t.url!==k&&(x.force?s(t.url):(v.trigger(b.request,[!0]),c(t.url,t.hash,t.data,t.scroll,!1))))}function s(e){j&&j.abort(),v.trigger(b.request,[!1]),x.transitionOutDeferred=x.transitionOut.apply(y,[!1]);var t=e.indexOf("?"),r=e.indexOf("#"),a={},n="",o=e,i="User error",l=null,s=$.Deferred();r>-1&&(n=e.slice(r),o=e.slice(0,r)),t>-1&&(a=h(e.slice(t+1,r>-1?r:e.length)),o=e.slice(0,t)),a[x.requestKey]=!0,j=$.ajax({url:o,data:a,dataType:"json",cache:x.cache,xhr:function(){var e=new y.XMLHttpRequest;return e.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/e.total;v.trigger(b.progress,[t])}},!1),e},success:function(t,r,a){l="string"===$.type(t)?$.parseJSON(t):t,t.location&&(e=t.location),s.resolve()},error:function(e,t,r){i=r,s.reject()}}),$.when(s,x.transitionOutDeferred).done(function(){c(e,n,l,x.jump?0:!1,!0)}).fail(function(){v.trigger(b.error,[i])})}function c(e,t,r,a,n){if(v.trigger(b.load,[r]),d(e),f(r),x.render.call(this,r,t),k=e,n?(history.pushState({url:k,data:r,scroll:a,hash:t},"state-"+k,k),L++):f(r),v.trigger(b.render,[r]),""!==t){var o=$(t);o.length&&(a=o.offset().top)}a!==!1&&v.scrollTop(a)}function u(e,t){if("undefined"!==$.type(e)){var r;for(var a in e)e.hasOwnProperty(a)&&(r=$(a),r.length&&r.html(e[a]))}}function f(e){var t=[];if("undefined"!==$.type(e)){var r;for(var a in e)e.hasOwnProperty(a)&&(r=$(a),r.length&&(t[a]=r.html()))}history.replaceState({url:k,data:t,scroll:v.scrollTop()},"state-"+k,k)}function p(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#039;/g,"'")}function d(e){if(e=e.replace(window.location.protocol+"//"+window.location.host,""),x.tracking.legacy)y._gaq=y._gaq||[],y._gaq.push(["_trackPageview",e]);else if(x.tracking.manager){var t={};t[x.tracking.variable]=e,y.dataLayer=window.dataLayer||[],y.dataLayer.push(t),y.dataLayer.push({event:x.tracking.event})}}function h(e){for(var t={},r=e.slice(e.indexOf("?")+1).split("&"),a=0;a<r.length;a++){var n=r[a].split("=");t[n[0]]=n[1]}return t}var g=e.Plugin("asap",{utilities:{_initialize:r,load:o},events:{popState:"popstate",request:"request",render:"render"}}),w={cache:!0,force:!1,jump:!0,modal:!1,selector:"a",render:$.noop,requestKey:"fs-asap",tracking:{legacy:!1,manager:!1,variable:"currentURL",event:"PageView"},transitionOut:$.noop},v=e.$window,y=v[0],m,O=g.functions,b=g.events,q=g.classes.raw,k="",L=0,j,x}(jQuery,Formstone);