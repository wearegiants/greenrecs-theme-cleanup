!function(e,t,i){"use strict";function o(){F=t.$body}function l(i){i.multiple=this.prop("multiple"),i.disabled=this.is(":disabled"),i.multiple?i.links=!1:i.external&&(i.links=!0);var o=this.find(":selected").not(":disabled"),l=o.text(),s=this.find("option").index(o);i.multiple||""===i.label?i.label="":(o=this.prepend('<option value="" class="'+D.item_placeholder+'" selected>'+i.label+"</option>"),l=i.label,s=0);var n=this.find("option, optgroup"),a=n.filter("option");i.tabIndex=this[0].tabIndex,this[0].tabIndex=-1;var d=[D.base,i.customClass];i.mobile||t.isMobile?d.push(D.mobile):i.cover&&d.push(D.cover),i.multiple&&d.push(D.multiple),i.disabled&&d.push(D.disabled);var c='<div class="'+d.join(" ")+'" tabindex="'+i.tabIndex+'"></div>',u="";i.multiple||(u+='<button type="button" class="'+D.selected+'">',u+=e("<span></span>").text(_(l,i.trim)).html(),u+="</button>"),u+='<div class="'+D.options+'">',u+="</div>",this.wrap(c).after(u),i.$dropdown=this.parent(q.base),i.$allOptions=n,i.$options=a,i.$selected=i.$dropdown.find(q.selected),i.$wrapper=i.$dropdown.find(q.options),i.$placeholder=i.$dropdown.find(q.placeholder),i.index=-1,i.guid=O++,i.closed=!0,i.keyDownGUID=U.keyDown+i.guid,i.clickGUID=U.click+i.guid,r(i),i.multiple||g(s,i),i.$selected.touch({tap:!0}).on(U.tap,i,p),i.$dropdown.on(U.click,q.item,i,v).on(U.close,i,m),this.on(U.change,i,b),t.isMobile||(i.$dropdown.on(U.focus,i,h).on(U.blur,i,w),this.on(U.focus,i,function(e){e.data.$dropdown.trigger(U.raw.focus)}))}function s(e){e.$dropdown.hasClass(D.open)&&e.$selected.trigger(U.click),e.$el[0].tabIndex=e.tabIndex,e.$dropdown.off(U.namespace),e.$options.off(U.namespace),e.$placeholder.remove(),e.$selected.remove(),e.$wrapper.remove(),e.$el.off(U.namespace).show().unwrap()}function n(e,t){if("undefined"!=typeof t){var i=e.$items.index(e.$items.filter("[data-value="+t+"]"));e.$items.eq(i).addClass(D.item_disabled),e.$options.eq(i).prop("disabled",!0)}else e.$dropdown.hasClass(D.open)&&e.$selected.trigger(U.click),e.$dropdown.addClass(D.disabled),e.$el.prop("disabled",!0),e.disabled=!0}function a(e,t){if("undefined"!=typeof t){var i=e.$items.index(e.$items.filter("[data-value="+t+"]"));e.$items.eq(i).removeClass(D.item_disabled),e.$options.eq(i).prop("disabled",!1)}else e.$dropdown.removeClass(D.disabled),e.$el.prop("disabled",!1),e.disabled=!1}function d(e){var t=e.index;e.$allOptions=e.$el.find("option, optgroup"),e.$options=e.$allOptions.filter("option"),e.index=-1,t=e.$options.index(e.$options.filter(":selected")),r(e),e.multiple||g(t,e)}function r(t){for(var i="",o=0,l=0,s=t.$allOptions.length;s>l;l++){var n=t.$allOptions.eq(l),a=[];if("OPTGROUP"===n[0].tagName)a.push(D.group),n.is(":disabled")&&a.push(D.disabled),i+='<span class="'+a.join(" ")+'">'+n.attr("label")+"</span>";else{var d=n.val();n.attr("value")||n.attr("value",d),a.push(D.item),n.hasClass(D.item_placeholder)&&a.push(D.item_placeholder),n.is(":selected")&&a.push(D.item_selected),n.is(":disabled")&&a.push(D.item_disabled),i+='<button type="button" class="'+a.join(" ")+'" ',i+='data-value="'+d+'">',i+=e("<span></span>").text(_(n.text(),t.trim)).html(),i+="</button>",o++}}t.$items=t.$wrapper.html(i).find(q.item)}function p(e){G.killEvent(e);var i=e.data;if(!i.disabled)if(i.mobile||!t.isMobile||t.isFirefoxMobile)i.closed?c(i):u(i);else{var o=i.$el[0];if(j.createEvent){var l=j.createEvent("MouseEvents");l.initMouseEvent("mousedown",!1,!0,M,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(l)}else o.fireEvent&&o.fireEvent("onmousedown")}}function c(t){if(t.closed){e(q.base).not(t.$dropdown).trigger(U.close,[t]);var i=t.$dropdown.offset(),o=F.outerHeight(),l=t.$wrapper.outerHeight(!0);t.index>=0?t.$items.eq(t.index).position():{left:0,top:0},i.top+l>o&&t.$dropdown.addClass(D.bottom),F.on(t.clickGUID,":not("+q.options+")",t,f),t.$dropdown.addClass(D.open),C(t),t.closed=!1}}function u(e){e&&!e.closed&&(F.off(e.clickGUID),e.$dropdown.removeClass([D.open,D.bottom].join(" ")),e.closed=!0)}function f(t){G.killEvent(t);var i=t.data;i&&0===e(t.currentTarget).parents(q.base).length&&u(i)}function m(e){var t=e.data;t&&u(t)}function v(t){G.killEvent(t);var i=e(this),o=t.data;if(!o.disabled){if(o.$wrapper.is(":visible")){var l=o.$items.index(i);l!==o.index&&(g(l,o),k(o))}o.multiple||u(o)}}function b(t,i){var o=e(this),l=t.data;if(!i&&!l.multiple){var s=l.$options.index(l.$options.filter("[value='"+E(o.val())+"']"));g(s,l),k(l)}}function h(e){G.killEvent(e);var t=e.data;t.disabled||t.multiple||t.$dropdown.addClass(D.focus).on(t.keyDownGUID,t,x)}function w(e,t){G.killEvent(e);var i=e.data;i.$dropdown.removeClass(D.focus).off(i.keyDownGUID),i.multiple||u(i)}function x(i){var o=i.data;if(13===i.keyCode)o.closed||(u(o),g(o.index,o)),k(o);else if(!(9===i.keyCode||i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)){G.killEvent(i);var l=o.$items.length-1,s=o.index<0?0:o.index;if(e.inArray(i.keyCode,t.isFirefox?[38,40,37,39]:[38,40])>-1)s+=38===i.keyCode||t.isFirefox&&37===i.keyCode?-1:1,0>s&&(s=0),s>l&&(s=l);else{var n,a,d=String.fromCharCode(i.keyCode).toUpperCase();for(a=o.index+1;l>=a;a++)if(n=o.$options.eq(a).text().charAt(0).toUpperCase(),n===d){s=a;break}if(0>s||s===o.index)for(a=0;l>=a;a++)if(n=o.$options.eq(a).text().charAt(0).toUpperCase(),n===d){s=a;break}}s>=0&&(g(s,o),C(o))}}function g(e,t){var i=t.$items.eq(e),o=t.$options.eq(e),l=i.hasClass(D.item_selected),s=i.hasClass(D.item_disabled);if(!s)if(t.multiple)l?(o.prop("selected",null),i.removeClass(D.item_selected)):(o.prop("selected",!0),i.addClass(D.item_selected));else if(e>-1&&e<t.$items.length){var n=o.data("label")||i.html();t.$selected.html(n).removeClass(q.item_placeholder),t.$items.filter(q.item_selected).removeClass(D.item_selected),t.$el[0].selectedIndex=e,i.addClass(D.item_selected),t.index=e}else""!==t.label&&t.$selected.html(t.label)}function C(e){var t=e.$items.eq(e.index),i=e.index>=0&&!t.hasClass(q.item_placeholder)?t.position():{left:0,top:0};e.$wrapper.scrollTop(e.$wrapper.scrollTop()+i.top)}function k(e){e.links?y(e):e.$el.trigger(U.raw.change,[!0])}function y(e){var t=e.$el.val();e.external?M.open(t):M.location.href=t}function _(e,t){return 0===t?e:e.length>t?e.substring(0,t)+"...":e}function E(e){return"string"==typeof e?e.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"):e}var I=t.Plugin("dropdown",{widget:!0,defaults:{cover:!1,customClass:"",label:"",external:!1,links:!1,mobile:!1,trim:0},methods:{_setup:o,_construct:l,_destruct:s,disable:n,enable:a,update:d,open:c,close:u},classes:["cover","bottom","multiple","mobile","open","disabled","focus","selected","options","group","item","item_disabled","item_selected","item_placeholder"],events:{tap:"tap",close:"close"}}),q=I.classes,D=q.raw,U=I.events,G=I.functions,O=0,M=t.window,j=(t.$window,t.document),F=null}(jQuery,Formstone);