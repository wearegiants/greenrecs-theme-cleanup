!function(e,i,o){"use strict";function t(e){Y.iterate.call(I,v)}function a(){I=e(w.base)}function r(i){i.guid="__"+j++,i.youTubeGuid=0,i.eventGuid=T.namespace+i.guid,i.rawGuid=P.base+i.guid,i.classGuid="."+i.rawGuid,i.$container=e('<div class="'+P.container+'"></div>').appendTo(this),this.addClass([P.base,i.customClass].join(" "));var o=i.source;i.source=null,s(i,o,!0),a()}function n(e){e.$container.remove(),this.removeClass([P.base,e.customClass].join(" ")).off(T.namespace),a()}function s(i,o,t){if(o!==i.source){if(i.source=o,i.responsive=!1,i.isYouTube=!1,"object"===e.type(o)&&"string"===e.type(o.video)){var a=o.video.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i);a&&a.length>=1&&(i.isYouTube=!0,i.videoId=a[1])}if(i.isYouTube)i.playing=!1,i.playerReady=!1,i.posterLoaded=!1,l(i,o,t);else if("object"===e.type(o)&&o.hasOwnProperty("poster"))c(i,o,t);else{var r=o;if("object"===e.type(o)){var n,s={},p=[];for(n in o)o.hasOwnProperty(n)&&p.push(n);p.sort(Y.sortAsc);for(n in p)p.hasOwnProperty(n)&&(s[p[n]]={width:parseInt(p[n]),url:o[p[n]]});i.responsive=!0,i.sources=s,r=d(i)}u(i,r,!1,t)}}else i.$el.trigger(T.loaded)}function d(e){if(e.responsive)for(var o in e.sources)if(e.sources.hasOwnProperty(o)&&i.windowWidth>=e.sources[o].width)return e.sources[o].url;return e.source}function u(i,o,t,a){var r=[P.media,P.image,a!==!0?P.animated:""].join(" "),n=e('<div class="'+r+'"><img></div>'),s=n.find("img"),d=o;s.one(T.load,function(){R&&n.addClass(P["native"]).css({backgroundImage:"url('"+d+"')"}),n.transition({property:"opacity"},function(){t||p(i)}).css({opacity:1}),g(i),(!t||a)&&i.$el.trigger(T.loaded)}).attr("src",d),i.responsive&&n.addClass(P.responsive),i.$container.append(n),(s[0].complete||4===s[0].readyState)&&s.trigger(T.load),i.currentSource=d}function c(o,t,a){if(o.source&&o.source.poster&&(u(o,o.source.poster,!0,!0),a=!1),!i.isMobile){var r=[P.media,P.video,a!==!0?P.animated:""].join(" "),n='<div class="'+r+'">';n+="<video",o.loop&&(n+=" loop"),o.mute&&(n+=" muted"),n+=">",o.source.webm&&(n+='<source src="'+o.source.webm+'" type="video/webm" />'),o.source.mp4&&(n+='<source src="'+o.source.mp4+'" type="video/mp4" />'),o.source.ogg&&(n+='<source src="'+o.source.ogg+'" type="video/ogg" />'),n+="</video>",n+="</div>";var s=e(n),d=s.find("video");d.one(T.loadedMetaData,function(e){s.transition({property:"opacity"},function(){p(o)}).css({opacity:1}),g(o),o.$el.trigger(T.loaded),o.autoPlay&&this.play()}),o.$container.append(s)}}function l(o,t,a){if(!o.videoId){var r=t.match(/^.*(?:youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#\&\?]*).*/);o.videoId=r[1]}if(o.posterLoaded||(o.source.poster||(o.source.poster="http://img.youtube.com/vi/"+o.videoId+"/0.jpg"),o.posterLoaded=!0,u(o,o.source.poster,!0,a),a=!1),!i.isMobile)if(e("script[src*='youtube.com/iframe_api']").length||e("head").append('<script src="//www.youtube.com/iframe_api"></script>'),_){var n=o.guid+"_"+o.youTubeGuid++,s=[P.media,P.embed,a!==!0?P.animated:""].join(" "),d='<div class="'+s+'">';d+='<div id="'+n+'"></div>',d+="</div>";var c=e(d);o.$container.append(c),o.player&&(o.oldPlayer=o.player,o.player=null),o.player=new C.YT.Player(n,{videoId:o.videoId,playerVars:{controls:0,rel:0,showinfo:0,wmode:"transparent",enablejsapi:1,version:3,playerapiid:n,loop:o.loop?1:0,autoplay:1,origin:C.location.protocol+"//"+C.location.host},events:{onReady:function(e){o.playerReady=!0,o.mute&&o.player.mute(),o.autoPlay&&o.player.playVideo()},onStateChange:function(e){o.playing||e.data!==C.YT.PlayerState.PLAYING?o.loop&&o.playing&&e.data===C.YT.PlayerState.ENDED&&o.player.playVideo():(o.playing=!0,o.autoPlay||o.player.pauseVideo(),c.transition({property:"opacity"},function(){p(o)}).css({opacity:1}),g(o),o.$el.trigger(T.loaded)),o.$el.find(w.embed).addClass(P.ready)},onPlaybackQualityChange:function(e){},onPlaybackRateChange:function(e){},onError:function(e){},onApiChange:function(e){}}}),g(o)}else G.push({data:o,source:t})}function p(e){var i=e.$container.find(w.media);i.length>=1&&(i.not(":last").remove(),e.oldPlayer=null)}function y(e){var i=e.$container.find(w.media);i.length>=1&&i.transition({property:"opacity"},function(){i.remove(),delete e.source}).css({opacity:0})}function h(e){if(e.isYouTube&&e.playerReady)e.player.pauseVideo();else{var i=e.$container.find("video");i.length&&i[0].pause()}}function f(e){if(e.isYouTube&&e.playerReady)e.player.playVideo();else{var i=e.$container.find("video");i.length&&i[0].play()}}function v(e){if(e.responsive){var i=d(e);i!==e.currentSource?u(e,i,!1,!0):g(e)}else g(e)}function g(e){for(var i=e.$container.find(w.media),o=0,t=i.length;t>o;o++){var a=i.eq(o),r=e.isYouTube?"iframe":a.find("video").length?"video":"img",n=a.find(r);if(n.length&&("img"!==r||!R)){var s=e.$el.outerWidth(),d=e.$el.outerHeight(),u=m(e,n);e.width=u.width,e.height=u.height,e.left=0,e.top=0;var c=e.isYouTube?e.embedRatio:e.width/e.height;e.height=d,e.width=e.height*c,e.width<s&&(e.width=s,e.height=e.width/c),e.left=-(e.width-s)/2,e.top=-(e.height-d)/2,a.css({height:e.height,width:e.width,left:e.left,top:e.top})}}}function m(i,o){if(i.isYouTube)return{height:500,width:500/i.embedRatio};if(o.is("img")){var t=o[0];if("undefined"!==e.type(t.naturalHeight))return{height:t.naturalHeight,width:t.naturalWidth};var a=new Image;return a.src=t.src,{height:a.height,width:a.width}}return{height:o[0].videoHeight,width:o[0].videoWidth}}var b=i.Plugin("background",{widget:!0,defaults:{autoPlay:!0,customClass:"",embedRatio:1.777777,loop:!0,mute:!0,source:null},classes:["container","media","animated","responsive","native","fixed","ready"],events:{loaded:"loaded",ready:"ready",loadedMetaData:"loadedmetadata"},methods:{_construct:r,_destruct:n,_resize:t,play:f,pause:h,resize:g,load:s,unload:y}}),w=b.classes,P=w.raw,T=b.events,Y=b.functions,C=i.window,I=[],j=0,R="backgroundSize"in i.document.documentElement.style,_=!1,G=[];C.onYouTubeIframeAPIReady=function(){_=!0;for(var e in G)G.hasOwnProperty(e)&&l(G[e].data,G[e].source);G=[]}}(jQuery,Formstone);