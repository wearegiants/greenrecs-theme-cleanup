!function($,e,t){"use strict";function a(e){e.touches=[],e.touching=!1,e.tap?(e.pan=!1,e.scale=!1,e.swipe=!1,this.on([X.touchStart,X.pointerDown].join(" "),e,o).on(X.click,e,l)):(e.pan||e.swipe||e.scale)&&(e.tap=!1,e.swipe&&(e.pan=!0),e.scale&&(e.axis=!1),e.axis?(e.axisX="x"===e.axis,e.axisY="y"===e.axis):d(this,"none"),this.on([X.touchStart,X.pointerDown].join(" "),e,i),e.pan&&this.on(X.mouseDown,e,o))}function n(e){d(this.off(X.namespace),"")}function i(e){e.preventManipulation&&e.preventManipulation();var t=e.data,a=e.originalEvent;if(a.type.match(/(up|end)$/i))return void r(e);if(a.pointerId){var n=!1;for(var i in t.touches)t.touches[i].id===a.pointerId&&(n=!0,t.touches[i].pageX=a.clientX,t.touches[i].pageY=a.clientY);n||t.touches.push({id:a.pointerId,pageX:a.clientX,pageY:a.clientY})}else t.touches=a.touches;a.type.match(/(down|start)$/i)?o(e):a.type.match(/move$/i)&&s(e)}function o(e){var t=e.data,a="undefined"!==$.type(t.touches)?t.touches[0]:null;if(t.touching||(t.startE=e.originalEvent,t.startX=a?a.pageX:e.pageX,t.startY=a?a.pageY:e.pageY,t.startT=(new Date).getTime(),t.scaleD=1,t.passed=!1),t.tap)t.clicked=!1,t.$el.on([X.touchMove,X.pointerMove].join(" "),t,i).on([X.touchEnd,X.touchCancel,X.pointerUp,X.pointerCancel].join(" "),t,i);else if(t.pan||t.scale){t.$links&&t.$links.off(X.click);var n=u(t.scale?X.scaleStart:X.panStart,e,t.startX,t.startY,t.scaleD,0,0,"","");if(t.scale&&t.touches&&t.touches.length>=2){var o=t.touches;t.pinch={startX:h(o[0].pageX,o[1].pageX),startY:h(o[0].pageY,o[1].pageY),startD:g(o[1].pageX-o[0].pageX,o[1].pageY-o[0].pageY)},n.pageX=t.startX=t.pinch.startX,n.pageY=t.startY=t.pinch.startY}t.touching||(t.touching=!0,t.pan&&M.on(X.mouseMove,t,s).on(X.mouseUp,t,r),M.on([X.touchMove,X.touchEnd,X.touchCancel,X.pointerMove,X.pointerUp,X.pointerCancel].join(" "),t,i),t.$el.trigger(n))}}function s(e){var t=e.data,a="undefined"!==$.type(t.touches)?t.touches[0]:null,n=a?a.pageX:e.pageX,i=a?a.pageY:e.pageY,o=n-t.startX,s=i-t.startY,c=o>0?"right":"left",p=s>0?"down":"up",l=Math.abs(o)>w,d=Math.abs(s)>w;if(t.tap)(l||d)&&t.$el.off([X.touchMove,X.touchEnd,X.touchCancel,X.pointerMove,X.pointerUp,X.pointerCancel].join(" "));else if(t.pan||t.scale)if(!t.passed&&t.axis&&(t.axisX&&d||t.axisY&&l))r(e);else{!t.passed&&(!t.axis||t.axis&&t.axisX&&l||t.axisY&&d)&&(t.passed=!0),t.passed&&(Y.killEvent(e),Y.killEvent(t.startE));var f=!0,v=u(t.scale?X.scale:X.pan,e,n,i,t.scaleD,o,s,c,p);if(t.scale)if(t.touches&&t.touches.length>=2){var M=t.touches;t.pinch.endX=h(M[0].pageX,M[1].pageX),t.pinch.endY=h(M[0].pageY,M[1].pageY),t.pinch.endD=g(M[1].pageX-M[0].pageX,M[1].pageY-M[0].pageY),t.scaleD=t.pinch.endD/t.pinch.startD,v.pageX=t.pinch.endX,v.pageY=t.pinch.endY,v.scale=t.scaleD,v.deltaX=t.pinch.endX-t.pinch.startX,v.deltaY=t.pinch.endY-t.pinch.startY}else t.pan||(f=!1);f&&t.$el.trigger(v)}}function c(e,t){e.on(X.click,t,p);var a=$._data(e[0],"events").click;a.unshift(a.pop())}function p(e){Y.killEvent(e,!0),e.data.$links.off(X.click)}function r(e){var t=e.data;if(t.tap)t.$el.off([X.touchMove,X.touchEnd,X.touchCancel,X.pointerMove,X.pointerUp,X.pointerCancel,X.mouseMove,X.mouseUp].join(" ")),t.startE.preventDefault(),l(e);else if(t.pan||t.scale){var a="undefined"!==$.type(t.touches)?t.touches[0]:null,n=a?a.pageX:e.pageX,i=a?a.pageY:e.pageY,o=n-t.startX,s=i-t.startY,p=(new Date).getTime(),r=t.scale?X.scaleEnd:X.panEnd,h=o>0?"right":"left",g=s>0?"down":"up",d=Math.abs(o)>1,f=Math.abs(s)>1;if(t.swipe&&Math.abs(o)>w&&p-t.startT<E&&(r=X.swipe),t.axis&&(t.axisX&&f||t.axisY&&d)||d||f){t.$links=t.$el.find("a");for(var v=0,Y=t.$links.length;Y>v;v++)c(t.$links.eq(v),t)}var k=u(r,e,n,i,t.scaleD,o,s,h,g);M.off([X.touchMove,X.touchEnd,X.touchCancel,X.mouseMove,X.mouseUp,X.pointerMove,X.pointerUp,X.pointerCancel].join(" ")),t.$el.trigger(k),t.touches=[],t.scale}t.touching=!1}function l(e){Y.killEvent(e);var t=e.data;if(!t.clicked){"click"!==e.type&&(t.clicked=!0);var a=t.startE?t.startX:e.pageX,n=t.startE?t.startY:e.pageY,i=u(X.tap,e.originalEvent,a,n,1,0,0);t.$el.trigger(i)}}function u(e,t,a,n,i,o,s,c,p){return $.Event(e,{originalEvent:t,bubbles:!0,pageX:a,pageY:n,scale:i,deltaX:o,deltaY:s,directionX:c,directionY:p})}function h(e,t){return(e+t)/2}function g(e,t){return Math.sqrt(e*e+t*t)}function d(e,t){e.css({"-ms-touch-action":t,"touch-action":t})}var f=!e.window.PointerEvent,v=e.Plugin("touch",{widget:!0,defaults:{axis:!1,pan:!1,scale:!1,swipe:!1,tap:!1},methods:{_construct:a,_destruct:n},events:{pointerDown:f?"MSPointerDown":"pointerdown",pointerUp:f?"MSPointerUp":"pointerup",pointerMove:f?"MSPointerMove":"pointermove",pointerCancel:f?"MSPointerCancel":"pointercancel"}}),X=v.events,Y=v.functions,M=e.$window,w=5,E=200;X.tap="tap",X.pan="pan",X.panStart="panstart",X.panEnd="panend",X.scale="scale",X.scaleStart="scalestart",X.scaleEnd="scaleend",X.swipe="swipe"}(jQuery,Formstone);