!function(e,t,a){"use strict";function n(e){e.touches=[],e.touching=!1,e.tap?(e.pan=!1,e.scale=!1,e.swipe=!1,this.on([Y.touchStart,Y.pointerDown].join(" "),e,s).on(Y.click,e,u)):(e.pan||e.swipe||e.scale)&&(e.tap=!1,e.swipe&&(e.pan=!0),e.scale&&(e.axis=!1),e.axis?(e.axisX="x"===e.axis,e.axisY="y"===e.axis):f(this,"none"),this.on([Y.touchStart,Y.pointerDown].join(" "),e,o),e.pan&&this.on(Y.mouseDown,e,s))}function i(e){f(this.off(Y.namespace),"")}function o(e){e.preventManipulation&&e.preventManipulation();var t=e.data,a=e.originalEvent;if(a.type.match(/(up|end)$/i))return void l(e);if(a.pointerId){var n=!1;for(var i in t.touches)t.touches[i].id===a.pointerId&&(n=!0,t.touches[i].pageX=a.clientX,t.touches[i].pageY=a.clientY);n||t.touches.push({id:a.pointerId,pageX:a.clientX,pageY:a.clientY})}else t.touches=a.touches;a.type.match(/(down|start)$/i)?s(e):a.type.match(/move$/i)&&c(e)}function s(t){var a=t.data,n="undefined"!==e.type(a.touches)?a.touches[0]:null;if(a.touching||(a.startE=t.originalEvent,a.startX=n?n.pageX:t.pageX,a.startY=n?n.pageY:t.pageY,a.startT=(new Date).getTime(),a.scaleD=1,a.passed=!1),a.tap)a.clicked=!1,a.$el.on([Y.touchMove,Y.pointerMove].join(" "),a,o).on([Y.touchEnd,Y.touchCancel,Y.pointerUp,Y.pointerCancel].join(" "),a,o);else if(a.pan||a.scale){a.$links&&a.$links.off(Y.click);var i=h(a.scale?Y.scaleStart:Y.panStart,t,a.startX,a.startY,a.scaleD,0,0,"","");if(a.scale&&a.touches&&a.touches.length>=2){var s=a.touches;a.pinch={startX:g(s[0].pageX,s[1].pageX),startY:g(s[0].pageY,s[1].pageY),startD:d(s[1].pageX-s[0].pageX,s[1].pageY-s[0].pageY)},i.pageX=a.startX=a.pinch.startX,i.pageY=a.startY=a.pinch.startY}a.touching||(a.touching=!0,a.pan&&w.on(Y.mouseMove,a,c).on(Y.mouseUp,a,l),w.on([Y.touchMove,Y.touchEnd,Y.touchCancel,Y.pointerMove,Y.pointerUp,Y.pointerCancel].join(" "),a,o),a.$el.trigger(i))}}function c(t){var a=t.data,n="undefined"!==e.type(a.touches)?a.touches[0]:null,i=n?n.pageX:t.pageX,o=n?n.pageY:t.pageY,s=i-a.startX,c=o-a.startY,p=s>0?"right":"left",r=c>0?"down":"up",u=Math.abs(s)>E,f=Math.abs(c)>E;if(a.tap)(u||f)&&a.$el.off([Y.touchMove,Y.touchEnd,Y.touchCancel,Y.pointerMove,Y.pointerUp,Y.pointerCancel].join(" "));else if(a.pan||a.scale)if(!a.passed&&a.axis&&(a.axisX&&f||a.axisY&&u))l(t);else{!a.passed&&(!a.axis||a.axis&&a.axisX&&u||a.axisY&&f)&&(a.passed=!0),a.passed&&(M.killEvent(t),M.killEvent(a.startE));var v=!0,X=h(a.scale?Y.scale:Y.pan,t,i,o,a.scaleD,s,c,p,r);if(a.scale)if(a.touches&&a.touches.length>=2){var w=a.touches;a.pinch.endX=g(w[0].pageX,w[1].pageX),a.pinch.endY=g(w[0].pageY,w[1].pageY),a.pinch.endD=d(w[1].pageX-w[0].pageX,w[1].pageY-w[0].pageY),a.scaleD=a.pinch.endD/a.pinch.startD,X.pageX=a.pinch.endX,X.pageY=a.pinch.endY,X.scale=a.scaleD,X.deltaX=a.pinch.endX-a.pinch.startX,X.deltaY=a.pinch.endY-a.pinch.startY}else a.pan||(v=!1);v&&a.$el.trigger(X)}}function p(t,a){t.on(Y.click,a,r);var n=e._data(t[0],"events").click;n.unshift(n.pop())}function r(e){M.killEvent(e,!0),e.data.$links.off(Y.click)}function l(t){var a=t.data;if(a.tap)a.$el.off([Y.touchMove,Y.touchEnd,Y.touchCancel,Y.pointerMove,Y.pointerUp,Y.pointerCancel,Y.mouseMove,Y.mouseUp].join(" ")),a.startE.preventDefault(),u(t);else if(a.pan||a.scale){var n="undefined"!==e.type(a.touches)?a.touches[0]:null,i=n?n.pageX:t.pageX,o=n?n.pageY:t.pageY,s=i-a.startX,c=o-a.startY,r=(new Date).getTime(),l=a.scale?Y.scaleEnd:Y.panEnd,g=s>0?"right":"left",d=c>0?"down":"up",f=Math.abs(s)>1,v=Math.abs(c)>1;if(a.swipe&&Math.abs(s)>E&&r-a.startT<k&&(l=Y.swipe),a.axis&&(a.axisX&&v||a.axisY&&f)||f||v){a.$links=a.$el.find("a");for(var X=0,M=a.$links.length;M>X;X++)p(a.$links.eq(X),a)}var m=h(l,t,i,o,a.scaleD,s,c,g,d);w.off([Y.touchMove,Y.touchEnd,Y.touchCancel,Y.mouseMove,Y.mouseUp,Y.pointerMove,Y.pointerUp,Y.pointerCancel].join(" ")),a.$el.trigger(m),a.touches=[],a.scale}a.touching=!1}function u(e){M.killEvent(e);var t=e.data;if(!t.clicked){"click"!==e.type&&(t.clicked=!0);var a=t.startE?t.startX:e.pageX,n=t.startE?t.startY:e.pageY,i=h(Y.tap,e.originalEvent,a,n,1,0,0);t.$el.trigger(i)}}function h(t,a,n,i,o,s,c,p,r){return e.Event(t,{originalEvent:a,bubbles:!0,pageX:n,pageY:i,scale:o,deltaX:s,deltaY:c,directionX:p,directionY:r})}function g(e,t){return(e+t)/2}function d(e,t){return Math.sqrt(e*e+t*t)}function f(e,t){e.css({"-ms-touch-action":t,"touch-action":t})}var v=!t.window.PointerEvent,X=t.Plugin("touch",{widget:!0,defaults:{axis:!1,pan:!1,scale:!1,swipe:!1,tap:!1},methods:{_construct:n,_destruct:i},events:{pointerDown:v?"MSPointerDown":"pointerdown",pointerUp:v?"MSPointerUp":"pointerup",pointerMove:v?"MSPointerMove":"pointermove",pointerCancel:v?"MSPointerCancel":"pointercancel"}}),Y=X.events,M=X.functions,w=t.$window,E=5,k=200;Y.tap="tap",Y.pan="pan",Y.panStart="panstart",Y.panEnd="panend",Y.scale="scale",Y.scaleStart="scalestart",Y.scaleEnd="scaleend",Y.swipe="swipe"}(jQuery,Formstone);